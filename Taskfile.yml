---
version: '3'
silent: true
env:
  ENV: .local/dev
  PROFILE: '{{.PROFILE | default ""}}'
dotenv: [".env", '{{.ENV}}/.env', '{{.HOME}}/.env']


# tasks are primarily for actions local to this repository. task is for things
# that usually don't need options (or can be configured once via a .env) use it
# especially when you have things that depend on other things

tasks:
  build:
    desc: build the npm package
    cmds:
      - |
        forge build
        npm run prepare
        npm run build
  test:
    desc: run the forge and hardhat tests
    cmds:
      - forge test -vvv && npx hardhat test

  deploy:
    desc: deploy the contracts
    cmds:
      - |
        PRIVATE_KEY=$(cat .local/dev/wallet-deploy.key)
        DEPLOYER_ADDR=$(cat .local/dev/wallet-deploy.addr)
        echo "PRIVATE_KEY: $PRIVATE_KEY"
        [ -z "$PRIVATE_KEY" ] && echo "no deployment key, try new-deploy-wallet" && exit 1

        echo "RPC_URL: $RPC_URL"
        echo "Deployer: $DEPLOYER_ADDR"
        CONTRACT=chaintrap/arena.sol:Arena
        forge create $CONTRACT \
          --legacy \
          --rpc-url=$RPC_URL \
          --private-key=$PRIVATE_KEY \
          --gas-limit=5000000
        #forge create HelloWorld \
        #  --constructor-args "Hello" \
        #  --contracts chaintrap/HelloWorld.sol \
        #  --legacy \
        #  --rpc-url=$RPC_URL \
        #  --private-key=$PRIVATE_KEY \
        #  --gas-limit=5000000

